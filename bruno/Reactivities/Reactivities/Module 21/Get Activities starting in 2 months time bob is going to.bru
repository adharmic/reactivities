meta {
  name: Get Activities starting in 2 months time bob is going to
  type: http
  seq: 7
}

get {
  url: {{url}}/api/activities?startDate={{activityDate}}&isGoing=true
  body: none
  auth: inherit
}

params:query {
  startDate: {{activityDate}}
  isGoing: true
}

script:pre-request {
  var moment = require("moment");
  
  bru.setEnvVar('activityDate', moment().add(4, 'months').toISOString());
}

script:post-response {
  var data = res.getBody();
  
  // response to be 200
  test("response is 200", function() {
      expect(res.getStatus()).to.equal(200)
  });
  
  test("has all properties", function() {
      expect(data[0]).to.have.property('id');
      expect(data[0]).to.have.property('title');
      expect(data[0]).to.have.property('description');
      expect(data[0]).to.have.property('date');
      expect(data[0]).to.have.property('city');
      expect(data[0]).to.have.property('venue');
      expect(data[0]).to.have.property('attendees');
  });
  
  test("has pagination header", function() {
      expect(res.getHeaders()).to.have.property("pagination".toLowerCase())
  })
}

settings {
  encodeUrl: true
}
